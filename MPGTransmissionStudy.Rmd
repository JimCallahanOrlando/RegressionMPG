---
title: "MPGTransmissionStudy.Rmd"
author: "Jim Callahan"
date: "October 7-19, 2015"
output: pdf_document
---
### Executive Summary ###  
This project is intended to answer the following two questions:  

1. “Is an automatic or manual transmission better for MPG?”  
2. "Quantify the MPG difference between automatic and manual transmissions?"  

using statistical regression analysis in **R** on the **"Motor Trend"**, **"mtcars"** data set
included with the **R** system.  This study does not show transmission type 
(automatic vs. manual) to be significant once one accounts for weight and 
number of engine cylinders. 
This result, however, may represent a flaw in the study design; this regression study, 
in effect uses group averages and not paired data. Paired data would be closer 
to the consumer experience of evaluating one model of car with (standard) manual 
or (optional) automatic transmission. 
There may be a more distinct effect when one examines one model of car at a time
with manual or automatic transmission rather than pooling several models of cars 
together in one data set.

### Data Vintage ###
The source of the **"mtcars"** data set (as described in the documentation **help(mtcars)** ) is
Henderson and Velleman (1981), **Building multiple regression models interactively.** 
Biometrics, 37, 391–411. 
http://www.mortality.org/INdb/2008/02/12/8/document.pdf

The **help(mtcars)** documentation states:  
  
> "The data was extracted from the **1974 Motor Trend** US magazine,  
> and comprises fuel consumption and 10 aspects of automobile design and performance  
> for 32 automobiles (**1973–74 models**)."  
  
So, it should be noted the **"mtcars"** data set is vintage **mid-1970s** and is therefore unlikely to be representative of the contemporary state of the automotive art.

### Exploratory Data Analysis ###
According to the **help(mtcars)** documentation, **"mtcars"** is  

> "A **data frame** with 32 observations on 11 variables.  
>  
> [, 1]	**mpg**	Miles/(US) gallon  
> [, 2]	**cyl**	Number of cylinders  
> [, 3]	**disp**	Displacement (cu.in.)  
> [, 4]	**hp**	Gross horsepower  
> [, 5]	**drat**	Rear axle ratio  
> [, 6]	**wt**	Weight (lb/1000)  
> [, 7]	**qsec**	1/4 mile time  
> [, 8]	**vs**	V/S  
> [, 9]	**am**	Transmission (0 = automatic, 1 = manual)  
> [,10]	**gear**	Number of forward gears  
> [,11]	**carb**	Number of carburetors"  
>  
  
The documentation is confirmed using the **str()** (structure) function in **R**:
```{r}
data(mtcars)
str(mtcars)
```


### Preliminary Analysis ###
On the surface the minimum requirements of this project are trivially simple:  
1. Convert the zero-one transmission indicator variable, **"am"** to an **R** **"factor"**.  
2. Run a regression with mpg = f(am) or in **R** notation **lm(mpg ~ am))**  
I have supressed the intercept ("0 + "), so the coefficients can be read off directly without
having to calculate the automatic transmision as a base plus an offset.
  
```{r}
# MPG Model zero "000" -- our "quick and dirty" literal regression
mtcars$am <- factor(mtcars$am,levels=c(0,1), labels=c("Auto","Man"))
MPGmod000 <- lm(mpg ~ 0 + as.factor(am), data=mtcars)
MPGmod000
```

So, the "quick and dirty" interpretation our base model zero, would be that  
the average 1975 vintage car with automatic transmission gets 17 miles per gallon
while the average 1975 vintage car with manual transmisson gets an additional 
7 miles per gallon for a total of 24 miles per gallon.

We can picture this with a box plot.


```{r, echo=TRUE}

plot(as.factor(mtcars$am), mtcars$mpg, 
     main = "Miles per Gallon (MPG)\nfor Automatic and Manual Transmissions", 
          ylab = "MPG")
abline(mtcars$mpg ~ as.factor(mtcars$am))

```

Clearly, as indicated by the dark horizontal line, the mean mpg of the manual transmission
cars is higher than the mean mpg of the automatic transmission cars. But, the "whiskers" of the
"box and whiskers" plot (the interquartile range) shows that the two ranges overlap; in other
words, some cars with manual transmissions have mpgs as low or lower than some cars
with automatic transmissions. If manual transmission cars always had higher mpg, there would
be no overlap of the interquartile ranges.

Of course to accept this analysis at face value, one would have to invoke the 
economist's assumption of "***ceteris paribus***" (all other things being equal).

Of course we know all other things are **NOT EQUAL**. There are **confounding variables**.
For instance, the cars vary in weight, number of cylinders in their engines and the
size of their engines measured in cubic inch displacement.

One, **low tech** way of seeing what is going on is simply to **sort the data set by mpg**
and look at the data.

```{r}
mtcars[order(-mtcars$mpg), ]
```
The **top 5 high mileage cars** tend to have **smaller engines (as measured by cylinders (cyl) displacemnet (disp) and horsepower (hp) )** and **weigh less than 2,200 pounds.** The **high milage cars** also tend to be **slower** (as measured by their quarter mile times (**qsec**)), have **manual transmissions (am = 1 or "Man")** with more gears (**gear**) and fewer carburetors (**carb**).
```{r}
head(mtcars[order(-mtcars$mpg), ], 5)
```
While the **bottom 5 low mileage cars** tend to have **bigger engines (as measured by cylinders (cyl) displacemnet (disp) and horsepower (hp) )** and **weigh more than 3,500 pounds.** The **low milage cars** also tend to be **faster** (as measured by their quarter mile times (**qsec**)), have **automatic transmissions (am = 0 or "Auto")** with fewer gears (**gear**) and more carburetors (**carb**).
```{r}
tail(mtcars[order(-mtcars$mpg), ], 5)
```

```{r}
attach(mtcars)
# wt = Weight (lb/1000)
summary( wt )
# cyl = Number of Cylinders
# Count of cars by Number of Cylinders
summary( as.factor(cyl) )
# mpg by Number of Cylinders
tapply(mpg, as.factor(cyl), mean )

# disp = Displacement (cu.in.)
summary(disp )
detach(mtcars)
```
### Historical Context ###
Moreover, keep in mind the historical context, this is the late 1970s/early 1980s when there was still a huge difference between American, European and Japanese auto technology.

> "In the mid-1980s, Toyota took over the Fremont [,California] plant, one of GM's worst, 
> a factory known for sex, drugs and defective vehicles. And as part of an historic 
> joint venture [NUMMI], Toyota turned the plant into one of GM's best, practically overnight.  
> Along the way — remarkably — Toyota even shared its production secrets. 
> ...  In 1985, after NUMMI opened, Car and Driver magazine ran the following   
> headline:  **'Hell Freezes Over.'** "    
**"The End Of The Line For GM-Toyota Joint Venture"**  by Frank Langfitt,  
National Public Radio (NPR), MARCH 26, 2010 3:00 PM ET  
http://www.npr.org/templates/story/story.php?storyId=125229157  

GM's Saturn was not introduced until the 1991 model year, ten years after 
the 1981 vintage of the "mtcars" data set.   
https://en.wikipedia.org/wiki/Saturn_Corporation

Electric vehicle hybrids, such as Toyota's Prius NHW11, were not introduced to the US market 
until the 2001 model year.  
https://en.wikipedia.org/wiki/Toyota_Prius 


A Web search for ggplot2 facet examples found a QuickR blog post,
"Graphics with ggplot2" by Robert I. Kabacoff, PhD.
http://www.statmethods.net/advgraphs/ggplot2.html
```{r}
# Separate regressions of mpg on weight for each number of cylinders
# create factors with value labels 
library(ggplot2)
data(mtcars)
mtcars$gear <- factor(mtcars$gear,levels=c(3,4,5),
                      labels=c("3gears","4gears","5gears")) 
mtcars$am <- factor(mtcars$am,levels=c(0,1),
                    labels=c("Automatic","Manual")) 
mtcars$cyl <- factor(mtcars$cyl,levels=c(4,6,8),
                     labels=c("4 cylinder","6 cylinder","8 cylinder")) 

# All -- use everything
MPGModAll <- lm(mpg  ~ . , data = mtcars); 
summary(MPGModAll)

# Weignt is significant
MPGmod001 <- lm(mpg ~ as.factor(am)+wt, data=mtcars)
summary(MPGmod001)

# Cylinders helps
MPGmod002 <- lm(mpg ~ as.factor(am)+wt+as.factor(cyl), data=mtcars)
summary(MPGmod002)

# drop Transmission (am) *** BEST MODEL ***
par(mfrow = c(1,2))
MPGmod003 <- lm(mpg ~ wt+as.factor(cyl), data=mtcars)
summary(MPGmod003)
plot(MPGmod003, which = 1)
plot(MPGmod003, which = 2)

MPGmod005 <- lm(mpg ~ log(wt), data=mtcars)
summary(MPGmod005)

MPGmod005 <- lm(mpg ~ log(wt)+as.factor(cyl), data=mtcars)
summary(MPGmod005)

qplot(wt, mpg, data=mtcars, geom=c("point", "smooth"), 
      method="lm", formula=y~x, color=cyl, 
      main="Regression of MPG on Weight by Engine Cylinders
    from QuickR blog post by Robert I. Kabacoff", 
      xlab="Weight (1,000 lbs)", 
      ylab="Miles per Gallon - MPG")

qplot(wt, mpg, data=mtcars, geom=c("point", "smooth"), 
      method="lm", formula=y~log(x), color=cyl, 
      main="Regression of MPG on Weight by Engine Cylinders
    from QuickR blog post by Robert I. Kabacoff", 
      xlab="Weight (1,000 lbs)", 
      ylab="Miles per Gallon - MPG")
```




